# SAF_pipeline
A demo usage of SAF pipeline

SAF Files Need:
1. Freesurfer_dir:<br>
├── label<br>
      ├─ lh.cortex.label<br>
      ├─ rh.cortex.label<br>
├── mri<br>
      ├─ brain.mgz<br>
      ├─ lh_cortex.nii.gz<br>
    ├─ rh_cortex.nii.gz<br>
    ├─ ribbon.mgz<br>
    ├─ trans_lh_cortex.nii.gz<br>
    ├─ trans_rh_cortex.nii.gz<br>
├── surf<br>
    ├─ lh.inflated<br>
    ├─ lh.pial<br>
    ├─ lh.white<br>
    ├─ lh.white.H<br>
    ├─ lh.white.K<br>
    ├─ rh.inflated<br>
    ├─ rh.pial<br>
    ├─ rh.white<br>
    ├─ rh.white.H<br>
    ├─ rh.white.K<br>
2. Tractography dir:
   Assume there is a subject dir named "sub-01", tractography dir should be "sub-01/SAF_output". Before run SAF pipeline, SAF_output should contain two files: surf_tracks.tck and DWI_seeds_out.txt. "surf_tracks.tck" is tractography results generated by UKF, Mrtrix, PTT... "DWI_seeds_out.txt" is seed point file of tractography results, it only be used in metrics calculate step. So, if you generate tractography results by PTT or UKF, which can not generate seed files, you can write a "fake" seed file by yourself. The files'  format like follows:<br>
   First line: # tckgen -output_seeds /data03/xizhu/100307_dwi/100307/T1w/Diffusion/SAF_output/DWI_seeds_out.txt -algorithm iFOD1 -seed_image /data03/xizhu/100307_dwi/100307/T1w/Diffusion/nodif_brain_mask.nii.gz -cutoff 0.05 -select 2M -maxlen 40 /data03/xizhu/100307_dwi/100307/T1w/Diffusion/fod.mif /data03/xizhu/100307_dwi/100307/T1w/Diffusion/SAF_output/surf_tracks.tck -force  (version=3.0.4) <br>
   Scond Line: #Track_index,Seed_index,Pos_x,Pos_y,Pos_z,<br>
   Others: Seed points<br>

   Replace file paths of your own file paths or not.<br>

If you prepare files need above, you can run "run_scripts.m". There are some difference between this repository and original repository:<br>
1. Add metrics calculate file.<br>
2. It would save not croped streamline as default, this is useful for HOA analysis.<br>


PTT tractography pipeline:
1. Generate grey matter-white matter interface mask.<br>
2. Generate fod use SWM mask.<br>
3. Run PTT.<br>
